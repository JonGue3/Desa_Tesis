<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <div th:replace="fragments/headerDashboard :: header-css"/>
</head>
<body>
<div id="wrapper">
    <div th:replace="fragments/sideBarMenu :: sideBarMenu"/>
    <div id="page-wrapper" class="gray-bg">
        <div th:replace="fragments/headerDashboard :: header-body"/>
        <div class="row" >
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="ibox-title">
                        <h5>Editar Proyecto</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="form-register">
                            <form class="m-t" role="form" data-parsley-validate="true" th:action="@{/saveEditProject}" th:object="${projectEntity}" method="post">
                                <div class="form-group" hidden="hidden">
                                    <input type="text" id="idProject" readonly="true" class="form-control" th:value="${projectEntity.idProject}" required="false" name="idProject">
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Nombre del Proyecto</label>
                                    <input type="text" id="projectName" readonly="true" class="form-control" th:value="${projectEntity.projectName}" required="false" name="projectName">
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Puntos Totales</label>
                                    <input type="text" class="form-control" th:value="${projectEntity.totalActivities}" required="true" name="totalActivities">
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Puntos Terminados</label>
                                    <input type="text" class="form-control" th:value="${projectEntity.finishedActivities}" required="true" name="finishedActivities">
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Fecha de Inicio</label>
                                    <input type="date" class="form-control"  th:text="${#dates.format(projectEntity.startDate.getTime(), 'dd/MM/yyyy')}" required="true" name="startDate">
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Fecha de Culminacion</label>
                                    <input type="date" class="form-control"  th:value="${#dates.format(projectEntity.endingDate.getTime(), 'dd/MM/yyyy')}" required="true" name="endingDate">
                                </div>
                                <div class="form-group">
                                    <div id="divLiderActual">
                                        <label class = "label-date">Lider Actual</label>
                                        <div id="selectLiderActual">
                                            <select  class="form-control" id="lideres" style="width: 95%; float: left;"  th:name="userEntityLideresInProject" required="true" >
                                                <option th:each="userList : ${projectEntity.userEntitySet}" th:if="${userList.profileEntity.idProfile == 2}"
                                                        th:text=" ${userList.fullName}"
                                                        th:value="${userList.idUser}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <span class="fa fa-trash fa-2x" id="deleteIcon" style="cursor: pointer; float: left; margin: 5px;"></span>
                                </div>
                                <div class="form-group">
                                    <label class = "label-date">Lider a Agregar</label>
                                    <select  class="form-control"  th:object="${userEntityList}" th:name="userEntity" required="false" >
                                        <option value="">Seleccione el Lider a agregar</option>
                                        <option th:each="userList : ${userEntityList}"
                                                th:text=" ${userList.fullName}"
                                                th:value="${userList.idUser}">
                                        </option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary block registerNewUser-right m-b" style="margin-top: 20px;">Guardar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div th:replace="fragments/footerDashboard :: footer"/>
    </div>
</div>

<script>
    $('#deleteIcon').on('click', function () {
        debugger;
        var lider = $('#lideres option:selected').val();
        var projectName = $('#projectName').val();
        var url = '/deleteLider';
        var data = {
            projectName : projectName,
            lider : lider
        }
        $.ajax({
            url : url,
            contentType: "application/json",
            type : 'post',
            dataType: 'json',
            data : JSON.stringify(data),
            success : function (response) {
                if (response.status === "SUCCESS") {
                    window.location.href = projectName;

                    //Actualizacion dinamica del select despues del delete
                    /*var userEntities = Object.assign({}, response.data);
                    // var userEntities = JSON.stringify(response.data);
                    $('#selectLiderActual').hide();
                    $('#divLiderActual').append(`<select  class="form-control" id="lideres" style="width: 95%; float: left;"  th:object="${userEntities}" th:name="userEntity" required="true" >\n` +
                        `                                                <option th:each="userList : ${userEntities}" \n` +
                        `                                                        \n` +
                        `                                                        >\n` +
                        `                                                </option>`);

                    $('#lideres').append(userEntities);
                    $('#lideres').prop("","");*/
                }
                console.log('ss');
            },
            error : function () {
                console.log("ERROR");
            }
        });

    });
</script>

</body>
</html>